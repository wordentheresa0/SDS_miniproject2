---
title: "MP2"
format: html
editor: visual
---

```{r}
library(tidyverse)
library(polite)
library(gutenbergr)
library(htmltools)
library(rvest)
```


```{r}
#Scrape the top 100 books from the past 30 days
get_gutenberg_top100 <- function() {
  if (robotstxt::paths_allowed("https://www.gutenberg.org/browse/scores/top#books-last30") == "TRUE") {
    gutenberg_page <- read_html("https://www.gutenberg.org/browse/scores/top#books-last30")
    books_last30 <- html_nodes(gutenberg_page, "#books-last30+ ol li")
    books_last30_text <- html_text(books_last30)
    books_last30_tbl <- tibble(
  title = gsub(" by.*", "", books_last30_text),
  author = gsub(".* by ", "", books_last30_text),
  popularity = seq.int(1,100)
)
    
  df_books30 <<- books_last30_tbl
  }
}

get_gutenberg_top100()
```
```{r}
top_100_books <- gutenberg_works() |>
  filter(title %in% df_books30$title)
#my_mirror <- "http://mirrors.xmission.com/gutenberg/"
top_100_text <- gutenberg_download(top_100_books$gutenberg_id, meta_fields = c("title", "author"))


top_100_data <- top_100_text |>
  mutate(text = na_if(text, "")) |>
  na.omit() |>
  group_by(title) |>
  mutate(line_num = row_number()) |>
  ungroup()
```


